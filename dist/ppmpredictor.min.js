!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).PPMPredictor={})}(this,function(t){"use strict";function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function o(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if("function"==typeof e){var o=function t(){var o=!1;try{o=this instanceof t}catch{}return o?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};o.prototype=e.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(t).forEach(function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(o,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})}),o}var r={exports:{}},n={},i={};var s,l,a=o(Object.freeze({__proto__:null,default:function(t,e){if(!t)throw new Error(e||"Assertion failed")}})),c={};function d(){if(s)return c;s=1;return c.rootSymbol=0,c.Vocabulary=class{constructor(){this.symbols_=Array(),this.symbols_.push("<R>"),this.oovSymbol_=-1}addSymbol(t){let e=this.symbols_.indexOf(t);if(e>=0)return e;const o=this.symbols_.length;return this.symbols_.push(t),o}getSymbolOrOOV(t){let e=this.symbols_.indexOf(t);return e>=0?e:(this.oovSymbol_=this.addSymbol("<OOV>"),this.oovSymbol_)}size(){return this.symbols_.length}},c}function h(){if(l)return i;l=1;const t=a,e=d();class o{constructor(){this.child_=null,this.next_=null,this.backoff_=null,this.count_=1,this.symbol_=e.rootSymbol}findChildWithSymbol(t){let e=this.child_;for(;null!=e;){if(e.symbol_==t)return e;e=e.next_}return e}totalChildrenCounts(t){let e=this.child_,o=0;for(;null!=e;)t&&t[e.symbol_]||(o+=e.count_),e=e.next_;return o}}class r{constructor(t,e){this.head_=t,this.order_=e}}return i.PPMLanguageModel=class{constructor(e,n){this.vocab_=e,t(this.vocab_.size()>1,"Expecting at least two symbols in the vocabulary"),this.maxOrder_=n,this.root_=new o,this.rootContext_=new r,this.rootContext_.head_=this.root_,this.rootContext_.order_=0,this.numNodes_=1,this.useExclusion_=!1}addSymbolToNode_(e,r){let n=e.findChildWithSymbol(r);return null!=n?n.count_++:(n=new o,n.symbol_=r,n.next_=e.child_,e.child_=n,this.numNodes_++,e==this.root_?n.backoff_=this.root_:(t(null!=e.backoff_,"Expected valid backoff node"),n.backoff_=this.addSymbolToNode_(e.backoff_,r))),n}createContext(){return new r(this.rootContext_.head_,this.rootContext_.order_)}cloneContext(t){return new r(t.head_,t.order_)}addSymbolToContext(o,r){if(!(r<=e.rootSymbol)){for(t(r<this.vocab_.size(),"Invalid symbol: "+r);null!=o.head_;){if(o.order_<this.maxOrder_){const t=o.head_.findChildWithSymbol(r);if(null!=t)return o.head_=t,void o.order_++}o.order_--,o.head_=o.head_.backoff_}null==o.head_&&(o.head_=this.root_,o.order_=0)}}addSymbolAndUpdate(o,r){if(r<=e.rootSymbol)return;t(r<this.vocab_.size(),"Invalid symbol: "+r);const n=this.addSymbolToNode_(o.head_,r);for(t(n==o.head_.findChildWithSymbol(r)),o.head_=n,o.order_++;o.order_>this.maxOrder_;)o.head_=o.head_.backoff_,o.order_--}getProbs(e){const o=this.vocab_.size();let r=new Array(o);for(let t=0;t<o;++t)r[t]=0;let n=null;if(this.useExclusion_){n=new Array(o);for(let t=0;t<o;++t)n[t]=!1}let i=1,s=e.head_,l=i;for(;null!=s;){const t=s.totalChildrenCounts(n);if(t>0){let e=s.child_;for(;null!=e;){const o=e.symbol_;if(!n||!n[o]){const s=l*(e.count_-.77)/(t+.49);r[o]+=s,i-=s,n&&(n[o]=!0)}e=e.next_}}s=s.backoff_,l=i}t(i>=0,"Invalid remaining probability mass: "+i);let a=0;for(let t=1;t<o;++t)n&&n[t]||a++;const c=i;for(let t=1;t<o;++t)if(!n||!n[t]){const e=c/a;r[t]+=e,i-=e}let d=o-1,h=0;for(let t=1;t<o;++t){const e=i/d;r[t]+=e,i-=e,h+=r[t],--d}return t(0==i,"Expected remaining probability mass to be zero!"),t(Math.abs(1-h)<1e-10),r}printToConsole_(t,e){console.log(e+"  "+this.vocab_.symbols_[t.symbol_]+"("+t.symbol_+") ["+t.count_+"]"),e+="  ";let o=t.child_;for(;null!=o;)this.printToConsole_(o,e),o=o.next_}printToConsole(){this.printToConsole_(this.root_,"")}},i}var f,u={};function b(){if(f)return u;function t(t,e){const o=t.length,r=e.length,n=Array(o+1).fill(null).map(()=>Array(r+1).fill(0));for(let t=0;t<=o;t++)n[t][0]=t;for(let t=0;t<=r;t++)n[0][t]=t;for(let i=1;i<=o;i++)for(let o=1;o<=r;o++)t[i-1]===e[o-1]?n[i][o]=n[i-1][o-1]:n[i][o]=Math.min(n[i-1][o]+1,n[i][o-1]+1,n[i-1][o-1]+1);return n[o][r]}function e(e,o){const r=Math.max(e.length,o.length);if(0===r)return 1;return 1-t(e,o)/r}function o(){return{q:["w","a","s"],w:["q","e","a","s","d"],e:["w","r","s","d","f"],r:["e","t","d","f","g"],t:["r","y","f","g","h"],y:["t","u","g","h","j"],u:["y","i","h","j","k"],i:["u","o","j","k","l"],o:["i","p","k","l"],p:["o","l"],a:["q","w","s","z","x"],s:["q","w","e","a","d","z","x","c"],d:["w","e","r","s","f","x","c","v"],f:["e","r","t","d","g","c","v","b"],g:["r","t","y","f","h","v","b","n"],h:["t","y","u","g","j","b","n","m"],j:["y","u","i","h","k","n","m"],k:["u","i","o","j","l","m"],l:["i","o","p","k"],z:["a","s","x"],x:["a","s","d","z","c"],c:["s","d","f","x","v"],v:["d","f","g","c","b"],b:["f","g","h","v","n"],n:["g","h","j","b","m"],m:["h","j","k","n"]}}function r(t,e){const o={q:["w","a","s"],w:["q","e","a","s","d"],e:["w","r","s","d","f"],r:["e","t","d","f","g"],t:["r","y","f","g","h"],y:["t","u","g","h","j"],u:["y","i","h","j","k"],i:["u","o","j","k","l"],o:["i","p","k","l"],p:["o","l"],a:["q","w","s","z","x"],s:["q","w","e","a","d","z","x","c"],d:["w","e","r","s","f","x","c","v"],f:["e","r","t","d","g","c","v","b"],g:["r","t","y","f","h","v","b","n"],h:["t","y","u","g","j","b","n","m"],j:["y","u","i","h","k","n","m"],k:["u","i","o","j","l","m"],l:["i","o","p","k"],z:["a","s","x"],x:["a","s","d","z","c"],c:["s","d","f","x","v"],v:["d","f","g","c","b"],b:["f","g","h","v","n"],n:["g","h","j","b","m"],m:["h","j","k","n"]},r=t.toLowerCase(),n=e.toLowerCase();return o[r]&&o[r].includes(n)}return f=1,u.levenshteinDistance=t,u.similarityScore=e,u.startsWith=function(t,e,o=!0){return o||(t=t.toLowerCase(),e=e.toLowerCase()),t.startsWith(e)},u.fuzzyMatch=function(o,r,n=2,i=.5){const s=[];for(const l of r){const r=t(o,l),a=e(o,l);r<=n&&a>=i&&s.push({text:l,distance:r,similarity:a})}return s.sort((t,e)=>Math.abs(t.similarity-e.similarity)>.001?e.similarity-t.similarity:t.distance-e.distance),s},u.getQwertyAdjacency=o,u.areKeysAdjacent=r,u.keyboardAwareDistance=function(t,e){const o=t.length,n=e.length,i=Array(o+1).fill(null).map(()=>Array(n+1).fill(0));for(let t=0;t<=o;t++)i[t][0]=t;for(let t=0;t<=n;t++)i[0][t]=t;for(let s=1;s<=o;s++)for(let o=1;o<=n;o++)if(t[s-1]===e[o-1])i[s][o]=i[s-1][o-1];else{const n=r(t[s-1],e[o-1])?.5:1;i[s][o]=Math.min(i[s-1][o]+1,i[s][o-1]+1,i[s-1][o-1]+n)}return i[o][n]},u}var y,m,p,x={};function _(){if(y)return x;function t(t){return t&&"string"==typeof t?Array.from(t):[]}return y=1,x.tokenize=function(t){return t&&"string"==typeof t?t.trim().split(/\s+/).filter(t=>t.length>0):[]},x.getLastPartialWord=function(t){if(!t||"string"!=typeof t)return"";const e=t.trimEnd(),o=e.split(/\s+/);return t!==e?"":o[o.length-1]||""},x.getContext=function(t){if(!t||"string"!=typeof t)return"";const e=t.trimEnd(),o=e.split(/\s+/);return t!==e?e:o.length<=1?"":o.slice(0,-1).join(" ")},x.endsWithWordBoundary=function(t){return!t||"string"!=typeof t||t!==t.trimEnd()},x.normalize=function(t,e=!0){if(!t||"string"!=typeof t)return"";let o=t.trim();return e&&(o=o.toLowerCase()),o},x.toCharArray=t,x.fromCharArray=function(t){return Array.isArray(t)?t.join(""):""},x.getNgrams=function(e,o){if(!e||"string"!=typeof e||o<1)return[];const r=t(e),n=[];for(let t=0;t<=r.length-o;t++)n.push(r.slice(t,t+o).join(""));return n},x.removePunctuation=function(t){return t&&"string"==typeof t?t.replace(/[^\w\s]/g,""):""},x.isAlphanumeric=function(t){return!(!t||"string"!=typeof t||1!==t.length)&&/^[a-zA-Z0-9]$/.test(t)},x.isWhitespace=function(t){return!(!t||"string"!=typeof t||1!==t.length)&&/^\s$/.test(t)},x}var g=(p||(p=1,function(t){const e=function(){if(m)return n;m=1;const t=h(),e=d(),o=b(),r=_();return n.Predictor=class{constructor(o={}){this.config={maxOrder:o.maxOrder||5,errorTolerant:void 0!==o.errorTolerant&&o.errorTolerant,maxEditDistance:o.maxEditDistance||2,minSimilarity:o.minSimilarity||.5,keyboardAware:void 0!==o.keyboardAware&&o.keyboardAware,caseSensitive:void 0!==o.caseSensitive&&o.caseSensitive,maxPredictions:o.maxPredictions||10,adaptive:void 0!==o.adaptive&&o.adaptive,lexicon:o.lexicon||[]},this.vocab=new e.Vocabulary;for(let t=32;t<=126;t++)this.vocab.addSymbol(String.fromCharCode(t));this.vocab.addSymbol("\n"),this.vocab.addSymbol("\t"),this.model=new t.PPMLanguageModel(this.vocab,this.config.maxOrder),this.context=this.model.createContext(),this.lexiconIndex=new Set(this.config.lexicon.map(t=>this.config.caseSensitive?t:t.toLowerCase()))}train(t){if(!t||"string"!=typeof t)return;const e=r.toCharArray(t),o=this.model.createContext();for(const t of e){const e=this.vocab.addSymbol(t);this.model.addSymbolAndUpdate(o,e)}}resetContext(){this.context=this.model.createContext()}addToContext(t,e=null){if(!t||"string"!=typeof t)return;const o=null!==e?e:this.config.adaptive,n=r.toCharArray(t);for(const t of n){let e=this.vocab.symbols_.indexOf(t);e<0&&(e=this.vocab.addSymbol(t)),o?this.model.addSymbolAndUpdate(this.context,e):this.model.addSymbolToContext(this.context,e)}}predictNextCharacter(t=null){let e=this.context;if(null!==t){e=this.model.createContext();const o=r.toCharArray(t);for(const t of o){let o=this.vocab.symbols_.indexOf(t);o<0&&(o=this.vocab.addSymbol(t)),this.model.addSymbolToContext(e,o)}}const o=this.model.getProbs(e),n=[];for(let t=1;t<o.length;t++)o[t]>0&&n.push({text:this.vocab.symbols_[t],probability:o[t]});return n.sort((t,e)=>e.probability-t.probability),n.slice(0,this.config.maxPredictions)}predictWordCompletion(t,e=""){if(!t||"string"!=typeof t)return[];const o=this.config.caseSensitive?t:t.toLowerCase();return this.lexiconIndex.size>0?this._predictFromLexicon(o,e):this._predictCharacterBased(t,e)}_predictFromLexicon(t,e){const r=[];for(const e of this.lexiconIndex)o.startsWith(e,t,this.config.caseSensitive)&&r.push(e);if(this.config.errorTolerant&&t.length>=2){const e=o.fuzzyMatch(t,Array.from(this.lexiconIndex),this.config.maxEditDistance,this.config.minSimilarity);for(const t of e)r.includes(t.text)||r.push(t.text)}return this._scoreCandidates(r,e)}_predictCharacterBased(t,e){const o=[],n=e+t,i=this.model.createContext(),s=r.toCharArray(n);for(const t of s){let e=this.vocab.symbols_.indexOf(t);e>=0&&this.model.addSymbolToContext(i,e)}const l=this._generateCompletions(i,t,20-t.length,5);for(const t of l)o.push({text:t.text,probability:t.probability});return o}_generateCompletions(t,e,o,r){const n=[],i=this.vocab.symbols_.indexOf(" ");let s=[{context:this.model.cloneContext(t),text:e,prob:1}];for(let t=0;t<o;t++){const t=[];for(const o of s){const r=this.model.getProbs(o.context),s=[];for(let t=1;t<r.length;t++)r[t]>0&&s.push({id:t,prob:r[t]});s.sort((t,e)=>e.prob-t.prob);for(let r=0;r<Math.min(3,s.length);r++){const l=s[r].id,a=this.vocab.symbols_[l];if(l===i||"\n"===a){o.text.length>e.length&&n.push({text:o.text,probability:o.prob});continue}const c=this.model.cloneContext(o.context);this.model.addSymbolToContext(c,l),t.push({context:c,text:o.text+a,prob:o.prob*s[r].prob})}}if(0===t.length)break;t.sort((t,e)=>e.prob-t.prob),s=t.slice(0,r)}for(const t of s)t.text.length>e.length&&n.push({text:t.text,probability:t.prob});return n.sort((t,e)=>e.probability-t.probability),n.slice(0,r)}_scoreCandidates(t,e){const o=[];for(const r of t){const t=this._scoreWord(r,e);o.push({text:r,probability:t})}return o.sort((t,e)=>e.probability-t.probability),o.slice(0,this.config.maxPredictions)}_scoreWord(t,e){const o=e+t,n=this.model.createContext();let i=0;const s=r.toCharArray(o);for(const t of s){const e=this.vocab.symbols_.indexOf(t);if(e>=0){const t=this.model.getProbs(n)[e]||1e-10;i+=Math.log(t),this.model.addSymbolToContext(n,e)}}return Math.exp(i/s.length)}getConfig(){return{...this.config}}updateConfig(t){this.config={...this.config,...t},t.lexicon&&(this.lexiconIndex=new Set(this.config.lexicon.map(t=>this.config.caseSensitive?t:t.toLowerCase())))}},n}(),o=h(),r=d(),i=b(),s=_(),l=e.Predictor||e,a=o.PPMLanguageModel||o,c=r.Vocabulary||r;function f(t={}){return new l(t)}function u(t={}){return new l({...t,errorTolerant:!1})}function y(t={}){return new l({...t,errorTolerant:!0})}const p={createPredictor:f,createStrictPredictor:u,createErrorTolerantPredictor:y,Predictor:l,PPMLanguageModel:a,Vocabulary:c,fuzzyMatcher:i,wordTokenizer:s,levenshteinDistance:i.levenshteinDistance,similarityScore:i.similarityScore,fuzzyMatch:i.fuzzyMatch};t.exports&&(t.exports=p,t.exports.createPredictor=f,t.exports.createStrictPredictor=u,t.exports.createErrorTolerantPredictor=y,t.exports.Predictor=l,t.exports.PPMLanguageModel=a,t.exports.Vocabulary=c,t.exports.fuzzyMatcher=i,t.exports.wordTokenizer=s,t.exports.levenshteinDistance=i.levenshteinDistance,t.exports.similarityScore=i.similarityScore,t.exports.fuzzyMatch=i.fuzzyMatch),"undefined"!=typeof window&&(window.PPMPredictor=p),t.exports=p}(r)),r.exports),v=e(g);t.default=v,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ppmpredictor.min.js.map
